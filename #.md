# reservation

## raw project

[reservation](https://github.com/tyrchen/reservation)

[excalidraw](https://excalidraw.com/)

## bilibili video

[#1 思考需求，构建 RFC](https://www.bilibili.com/video/BV1aV4y1L72b)

[#2 设计数据库 schema](https://www.bilibili.com/video/BV1rt4y1c7Bw)

[#3 系统设计](https://www.bilibili.com/video/BV18e4y1n7fc)

[#4 构建 gRPC 接口](https://www.bilibili.com/video/BV1KB4y177kz)

[#5 使用 sqlx 构建 migration](https://www.bilibili.com/video/BV18t4y1c78e)

[#6 实现预定功能](https://www.bilibili.com/video/BV1Ad4y1y7AM)

[#7 对 sqlx 进行测试](https://www.bilibili.com/video/BV1gm4y1w7YS)

## RFCs

### service interface

[protos](abi/protos/reservation.proto)

``` sql
CREATE DATABASE rsys;

--
CREATE SCHEMA rsvp;

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "btree_gist";

CREATE TABLE rsvp.reservations (
    id uuid NOT NULL DEFAULT uuid_generate_v4(),
    user_id VARCHAR(64) ,--NOT NULL,
    rstatus integer NOT NULL DEFAULT 0,
    resource_id VARCHAR(64) ,--NOT NULL,

    --timespan TSTZRANGE ,--NOT NULL,
    start_time timestamp,
    end_time timestamp,

    note TEXT,

    CONSTRAINT reservations_pkey PRIMARY KEY (id)
    --CONSTRAINT reservations_conflict EXCLUDE USING gist (resource_id WITH =, timespan WITH &&)
);
CREATE INDEX reservations_resource_id_idx ON rsvp.reservations (resource_id);
CREATE INDEX reservations_user_id_idx ON rsvp.reservations (user_id);

CREATE TABLE rsvp.reservation_changes (
    id SERIAL NOT NULL,
    reservation_id uuid NOT NULL,
    op integer NOT NULL DEFAULT 0,

    CONSTRAINT reservation_changes_pkey PRIMARY KEY (id)
);
```

``` postgresql
https://www.postgresql.org/docs/14/rangetypes.html
https://www.postgresql.org/docs/14/indexes-types.html
https://www.postgresqltutorial.com/
```

``` orm
https://www.sea-ql.org/
https://www.sea-ql.org/sea-orm-tutorial/ch00-00-introduction.html
https://www.sea-ql.org/SeaORM/docs/generate-entity/entity-structure/

.env DATABASE_URL=postgresql://postgres:post@localhost:5432/rsys

sea-orm-cli migrate init
sea-orm-cli generate entity -o src/entities -s rsvp
```
